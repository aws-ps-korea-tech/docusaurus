"use strict";(globalThis.webpackChunkaws_ps_tech_docs=globalThis.webpackChunkaws_ps_tech_docs||[]).push([[7486],{4333(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"omics-on-aws/aws-glue","title":"AWS Glue","description":"\\\\","source":"@site/docs/omics-on-aws/aws-glue.md","sourceDirName":"omics-on-aws","slug":"/omics-on-aws/aws-glue","permalink":"/docusaurus/en/omics-on-aws/aws-glue","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-wwps-kr-tech/docusaurus/tree/main/docs/omics-on-aws/aws-glue.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"AWS Glue","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Amazon EMR on EC2","permalink":"/docusaurus/en/omics-on-aws/amazon-emr-on-ec2"},"next":{"title":"Hail with Amazon EMR notebook","permalink":"/docusaurus/en/omics-on-aws/hail-with-amazon-emr-notebook"}}');var i=s(4848),o=s(8453);const r={title:"AWS Glue",sidebar_position:1},a=void 0,c={},t=[{value:"\uc0ac\uc804 \uc900\ube44",id:"\uc0ac\uc804-\uc900\ube44",level:2},{value:"AWS IAM",id:"aws-iam",level:2},{value:"GetRole, PassRole",id:"getrole-passrole",level:3},{value:"S3 Read",id:"s3-read",level:3},{value:"AWS Glue",id:"aws-glue",level:2},{value:"Optional \ub2e8\uacc4",id:"optional-\ub2e8\uacc4",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\\"}),"\n",(0,i.jsx)(n.p,{children:"\uc5ec\uae30\uc11c\ub294 Hail\uc744 VCF to Parquet \ubaa9\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsxs)(n.p,{children:["\uc2a4\ud06c\ub9b0\uc0f7\uc774 \ucca8\ubd80\ub41c \ubc84\uc804\uc740 ",(0,i.jsx)(n.a,{href:"https://www.notion.so/awsimd/VCF-to-Parquet-12b6fbb36ef1445da0f14ae9b75cf8d3?pvs=4",children:"\uc5ec\uae30"}),"\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.h2,{id:"\uc0ac\uc804-\uc900\ube44",children:"\uc0ac\uc804 \uc900\ube44"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://hyunmink.awsapps.com/workdocs/index.html#/share/document/572930260ca4d28c62f10d95068e0d3991cf400e5bc91e3fc035ab0305767315",children:"hail-all-spark.jar"})," \ud30c\uc77c\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc2b5\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Amazon S3 \uc11c\ube44\uc2a4\ub85c \uc811\uc18d\ud574\uc11c \uc55e\uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc740 ",(0,i.jsx)(n.code,{children:"hail-all-spark.jar"})," \ud30c\uc77c\uc744 \ubcf8\uc778\uc5d0 \uc54c\ub9de\uc740 \ubc84\ud0b7\uc5d0 \uc5c5\ub85c\ub4dc\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\uc5c5\ub85c\ub4dc\ud55c ",(0,i.jsx)(n.code,{children:"hail-all-spark.jar"})," \ud30c\uc77c\uc744 \uc120\ud0dd\ud558\uace0 ",(0,i.jsx)(n.code,{children:"Copy S3 URL"}),"\uc744 \ub20c\ub7ec \uc8fc\uc18c\ub97c \ubcf5\uc0ac\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\uc774 \ubcf5\uc0ac\ud55c \uc8fc\uc18c\ub294 \ub2e4\uc74c \uc139\uc158\uc5d0\uc11c \ub2e4\ub8f0 AWS Glue\uc758 \ub178\ud2b8\ubd81 \uc791\uc5c5 \ucf54\ub4dc\uc5d0 \ud544\uc694\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.h2,{id:"aws-iam",children:"AWS IAM"}),"\n",(0,i.jsxs)(n.p,{children:["IAM \uc11c\ube44\uc2a4\ub85c \uc9c4\uc785\ud558\uc5ec \uc815\uc758\ub41c Role \uc744 \uc218\uc815\ud569\ub2c8\ub2e4. ",(0,i.jsx)(n.code,{children:"GenomicsAnalysis-Genomics-JobRole-*"})," \uc73c\ub85c \uac80\uc0c9\ud558\uc5ec \ub098\uc624\ub294 Role\uc5d0 \ub300\ud574\uc11c 2\uac00\uc9c0 Policy\ub97c \ucd94\uac00\ud560 \uac83\uc785\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.h3,{id:"getrole-passrole",children:"GetRole, PassRole"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create inline policy \ub97c \ud074\ub9ad\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsxs)(n.li,{children:["\ub2e4\uc74c\uacfc \uac19\uc774 Policy\ub97c JSON\uc744 \uc120\ud0dd\ud574\uc11c \uc791\uc131\ud569\ub2c8\ub2e4. \uc774\ub54c \ubc18\ub4dc\uc2dc ",(0,i.jsx)(n.code,{children:"\ub294 \ubcf8\uc778\uc758 AWS \uacc4\uc815\uc544\uc774\ub514\uc640 "}),"\uc740 \ud574\ub2f9\ub418\ub294 \uac83\uc73c\ub85c \ubcc0\uacbd\ud574\uc11c \uc791\uc131\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'**:role/****"\n            ]\n        }\n    ]\n}\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\uc791\uc131\ud55c \ucee4\uc2a4\ud140 \uc815\ucc45\uc758 \uc774\ub984\uc744 \uc785\ub825\ud558\uace0 ",(0,i.jsx)(n.code,{children:"Create policy"}),"\ub97c \ud074\ub9ad\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:["\uc544\ub798\uc640 \uac19\uc774 \ubc29\uae08 \ub9cc\ub4e0 \uc815\ucc45\uc774 \ud574\ub2f9 Role\uc5d0 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\uc5ec\uae30\uc11c\ub294 ",(0,i.jsx)(n.code,{children:"MyGluePolicy"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"s3-read",children:"S3 Read"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\uc774\ubc88\uc5d0\ub294 \uc0ac\uc804 \uc815\uc758\ub41c \uc815\ucc45\uc744 \ucca8\ubd80\ud558\uc5ec \ucd94\uac00\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. ",(0,i.jsx)(n.code,{children:"Add permissions"})," > ",(0,i.jsx)(n.code,{children:"Attach policies"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AmazonS3ReadOnlyAccess"})," \uc815\ucc45\uc744 \uac80\uc0c9\ud558\uc5ec \uc120\ud0dd\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:["\ucd5c\uc885\uc801\uc73c\ub85c \uc544\ub798\uc640 \uac19\uc774 2\uac1c\uc758 Policy\uac00 2\uac1c\ub354 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\uc5ec\uae30\uc11c\ub294 ",(0,i.jsx)(n.code,{children:"MyGluePolicy"})," , ",(0,i.jsx)(n.code,{children:"AmazonS3ReadOnlyAccess"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\\"}),"\n",(0,i.jsx)(n.h2,{id:"aws-glue",children:"AWS Glue"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\ucf58\uc194\uc744 \ud1b5\ud574 AWS Glue \uc11c\ube44\uc2a4\uc5d0 \uc811\uc18d\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"ETL jobs > Notebook \uc744 \ud074\ub9ad\ud574\uc11c \uc0c8\ub85c\uc6b4 \ub178\ud2b8\ubd81\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\uc774\ub54c IAM role \uc740 \uc0ac\uc804\uc5d0 \uc0dd\uc131\ub418\uc5b4 \uc788\ub294 ",(0,i.jsx)(n.code,{children:"GenomicsAnalysis-Genomics-JobRole-*"})," \ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["Glue notebook \ucc3d\uc73c\ub85c \ub3cc\uc544\uc640 \uc544\ub798 \ucf54\ub4dc\ub97c \ubaa8\ub450 \ubd99\uc5ec \ub123\uc2b5\ub2c8\ub2e4. hail-all-spark.jar\uc758S3 URI \uc0c8\ub85c\uc6b4 \uc140\uc744 \ucd94\uac00\ud558\ub824\uba74 \uc6d0\ud558\ub294 \uc704\uce58\uc5d0\uc11c ",(0,i.jsx)(n.code,{children:"+"}),"\ub97c \ub20c\ub7ec \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\\"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'%idle_timeout 2880\n%glue_version 4.0\n%worker_type G.1X\n%number_of_workers 5\n%additional_python_modules hail\n%extra_jars "****"\n%%configure\n\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Import sys\nfrom pyspark.context Import SparkContext\nfrom awsglue.context Import GlueContext\nfrom awsglue.job Import Job\n\nImport hail as hl\n\nsc = SparkContext.getOrCreate()\nhl.init(sc=sc)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'glueContext = GlueContext(sc)\nspark = glueContext.spark_session\njob = Job(glueContext)\n\njob.init("JobNameEx")\n\nvds = hl.import_vcf("s3://****/genomics-tertiary-analysis-and-data-lakes-using-aws-glue-and-amazon-athena/latest/variants/vcf/variants.vcf.gz", force_bgz=True, reference_genome=\'GRCh38\')\n\nvds.make_table().to_spark().write.mode(\'overwrite\').parquet("s3://****/genomics-tertiary-analysis-and-data-lakes-using-aws-glue-and-amazon-athena/latest/variants/vcf_to_parquet")\n\njob.commit()\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"\uc774\uc81c S3 \ucf58\uc194\ub85c \uc811\uc18d\ud558\uc5ec \uacb0\uacfc Parquet\uc774 \uc798 \ub9cc\ub4e4\uc5b4\uc84c\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\\"}),"\n",(0,i.jsx)(n.h2,{id:"optional-\ub2e8\uacc4",children:"Optional \ub2e8\uacc4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ud574\ub2f9 \ub370\uc774\ud130\ub97c S3\uc758 Query with S3 Select \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud574 \ucffc\ub9ac\ud574\ubd05\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"\ud574\ub2f9 \ub370\uc774\ud130\ub97c AWS Glue \ud06c\ub864\ub7ec\ub97c \ub9cc\ub4e4\uc5b4 \uce74\ud0c8\ub85c\uae45\ud574\ubd05\ub2c8\ub2e4. \uadf8\ub9ac\uace0 Athena \uc5d0\uc11c \ucffc\ub9ac\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>a});var l=s(6540);const i={},o=l.createContext(i);function r(e){const n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);